// dmc0.01(4/24/2015)
var MARGIN=0;var container,camera,scene,renderer;var screen_W=window.innerWidth;var screen_H=window.innerHeight-2*MARGIN;var texture,effect,composer,postEffect,resolution,numBlobs;var light,pointLight1,pointLight2,ambientLight;var time=0;var clock=new THREE.Clock();init();animate();function init(){container=document.getElementById("container");camera=new THREE.PerspectiveCamera(45,screen_W/screen_H,1,10000);camera.position.z=1000;scene=new THREE.Scene();scene.fog=new THREE.Fog(1315860,700,1500);light=new THREE.DirectionalLight(6250335);scene.add(light);pointLight1=new THREE.PointLight(396428);pointLight1.position.set(0,0,100);scene.add(pointLight1);pointLight2=new THREE.PointLight(6620288);pointLight2.position.set(0,50,130);scene.add(pointLight2);ambientLight=new THREE.AmbientLight(3289673);scene.add(ambientLight);materials=generateMaterials();current_material="clear";resolution=50;effect=new THREE.MarchingCubes(resolution,materials[current_material].m,true,true);effect.position.set(100,200,0);effect.scale.set(500,500,500);scene.add(effect);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setClearColor(1315860);renderer.setPixelRatio(window.devicePixelRatio);renderer.setSize(screen_W,screen_H);renderer.gammaInput=true;renderer.gammaOutput=true;container.appendChild(renderer.domElement);renderer.physicallyBasedShading=true;controls=new THREE.OrbitControls(camera,renderer.domElement);setup();window.addEventListener("resize",onWindowResize,false);}function onWindowResize(event){screen_W=window.innerWidth;screen_H=window.innerHeight-2*MARGIN;camera.aspect=screen_W/screen_H;camera.updateProjectionMatrix();renderer.setSize(screen_W,screen_H);}function generateMaterials(){var materials={clear:{m:new THREE.MeshPhongMaterial({color:5658198,specular:16777215,shininess:250}),h:0.1,s:0.8,l:0.1},};return materials;}function setup(){effectController={material:"clear",speed:0.4,numBlobs:5,resolution:60,isolation:60};}function updateCubes(object,time,numblobs){object.reset();var i,ballx,bally,ballz,subtract,strength;subtract=12;strength=1.2/((Math.sqrt(numblobs)-1)/4+1);for(i=0;i<numblobs;i++){ballx=Math.sin(i+1.26*time*(1.03+0.5*Math.cos(0.21*i)))*0.27+0.5;bally=Math.abs(Math.cos(i+1.12*time*Math.cos(1.22+0.1424*i)))*0.27+0.2;ballz=Math.cos(i+1.32*time*0.1*Math.sin((0.92+0.53*i)))*0.27+0.5;object.addBall(ballx,bally,ballz,strength,subtract);}}function animate(){requestAnimationFrame(animate);render();}function render(){var delta=clock.getDelta();time+=delta*effectController.speed*0.3;controls.update(delta);if(effectController.resolution!==resolution){resolution=effectController.resolution;effect.init(resolution);}if(effectController.isolation!==effect.isolation){effect.isolation=effectController.isolation;}updateCubes(effect,time,effectController.numBlobs);renderer.render(scene,camera);}